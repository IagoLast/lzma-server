const lzma = require('./lzma');
const assert = require('assert');
const encoded = '3YCAiICvhYCAgICAgIC9CAjntIUbMkyt4S6xq5e9KCiZiA/k16XZNpEjL0UplWZ1Q/1d7Fyeo+O6YbO+ve/SdpY78LbyuCUtLRobMbG00Gqla/nAmUWbPFC25c8UFmdZv9xQ57TN2apJbxha4GSyBZqka/ryXIkcOOFFdm8oOWSoqWygrr4gqYEjCWwIoYmO8B2u40fKyUTaZCSJ8aLFxVD69VBH0iQr/fOtm74JO29t8w+98YaXmGaSVdyEUVnhY56gMQ9CLkTSU1cstyMQZKPAwMcUMc0f3xoc17FMDv6LJmwHlgd93FcUvnGl3NhOI898QGJ7FH+g5+YWoTw4/pUJPldlmq37psyQCdF94ptxCXuueBuGbHMCIskSWzgGLaSRyjbHhUTQ77TbEutb8nD2SRY7h/6dgI9o95a3CGgIphRnyJK1ZYOJ+44Ez9K7lzjs294qopPOe+42syihhfn0kgeuBbnr0fD99n+omrjlw3IrC3wH7/6MRL0v8p04NMxJvaPrXPRBlORsQosBaqeM6eXoIvfhIQTssmFQm8CR+gzSufMsDZesgZq6Oc5qpbCm77vaPr83dkyBM3rWY2IZKmeF8O8p9tSe+VIloKa2taiQjUpI5nIobGF9VBXw3fphvs3oqS98aMpOGCQ/266UB65ZTIQ2baydoa+PWrGNmr6xPTzuW9Tg7tGwdesKcVkVySneLq4mNk1ZJQkc7ey/6tQ+SmcR0pv9kuJpRjRL7ns3o4gZVc3fLZDGlzezPIv/SJiJAckcgoykAolNCQqXwrKpgX9UaPUAuVAlQOD/t5ebv55LdSmlAGKfJXezvPITivrbgaOY70g3/KqKbAN+At1yNX/EqApziLb94Mx84lFfWH7uPi4U9KpsqvyOcHwUXAI=';
const expected = {
    "config": "{\"buffersize\":{\"mvt\":0},\"layers\":[{\"id\":\"ae7c1236-dd40-4e16-8f84-d0cc35b50224\",\"type\":\"http\",\"options\":{\"urlTemplate\":\"https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager_nolabels/{z}/{x}/{y}.png\",\"subdomains\":\"abcd\"}},{\"id\":\"55c9dc27-9c58-466a-909e-d9e90b318194\",\"type\":\"mapnik\",\"options\":{\"cartocss\":\"#layer {\\n  marker-width: 7;\\n  marker-fill: ramp([scalerank], (#100100, #ee919b, #cc607d, #9e3963, #672044), quantiles);\\n  marker-fill-opacity: 1;\\n  marker-allow-overlap: true;\\n  marker-line-width: 1;\\n  marker-line-color: #FFFFFF;\\n  marker-line-opacity: 1;\\n}\",\"cartocss_version\":\"2.1.1\",\"source\":{\"id\":\"a0\"},\"interactivity\":[\"cartodb_id\"]}},{\"id\":\"5f2df7cd-92ea-43e9-9caa-7e6977f9f51b\",\"type\":\"http\",\"options\":{\"urlTemplate\":\"https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager_only_labels/{z}/{x}/{y}.png\",\"subdomains\":\"abcd\"}}],\"dataviews\":{\"38491a36-583a-4c54-b874-be7641e2877f\":{\"type\":\"aggregation\",\"source\":{\"id\":\"a0\"},\"options\":{\"column\":\"featurecla\",\"aggregation\":\"count\",\"aggregationColumn\":\"featurecla\"}}},\"analyses\":[{\"id\":\"a0\",\"type\":\"source\",\"params\":{\"query\":\"SELECT * FROM \\\"iago-carto\\\".ne_10m_populated_places_simple_1\"}}]}"
};

lzma.decode(encoded).then(actual => {
    assert.deepEqual(actual, expected);
});